
<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>ESP8266_VGM_Player_PSG_YM2612 联合开发网 - pudn.com</title>

    <link href="/Public/m/css/bootstrap.min.css" rel="stylesheet">
    <link href="/Public/m/font-awesome/css/font-awesome.css" rel="stylesheet">

    <link href="/Public/m/css/animate.css" rel="stylesheet">
    <link href="/Public/m/css/style.css" rel="stylesheet">

	<link href="/Public/m/css/plugins/slick/slick.css" rel="stylesheet">
	<link href="/Public/m/css/plugins/slick/slick-theme.css" rel="stylesheet">

	

	<link href="/css/style.css" rel="stylesheet">

	<!-- Mainly scripts -->
	<script src="/Public/m/js/jquery-2.1.1.js"></script>
	<script src="/Public/m/js/bootstrap.min.js"></script>

	<script src="/Public/m/js/plugins/metisMenu/jquery.metisMenu.js"></script>
	<script src="/Public/m/js/plugins/slimscroll/jquery.slimscroll.min.js"></script>

	<!-- Custom and plugin javascript -->
	<script src="/Public/m/js/inspinia.js"></script>
	<script src="/Public/m/js/plugins/pace/pace.min.js"></script>
	
<META name="Keywords" content="ESP8266_VGM_Player_PSG_YM2612 程序员 编程 源码 源代码 下载">

	
<META name="Description" content="ESP8266_VGM_Player_PSG_YM2612 VGM（视频游戏音乐）播放器，采用世嘉Genesis的YM2612和SN76489 PSG。，">

</head>

<body>

<!-- /.main-container start -->

<div class="pace  pace-inactive">
  	<div class="pace-progress" data-progress-text="100%" data-progress="99" style="transform: translate3d(100%, 0px, 0px);">
  	<div class="pace-progress-inner"></div>
	</div>
	<div class="pace-activity"></div>
</div>

<div class="all-content">
	<div class="my-container top-navigation">
		<nav class="navbar navbar-static-top" role="navigation">
			<div class="navbar-header">
				<button aria-controls="navbar" aria-expanded="false" data-target="#navbar" data-toggle="collapse" class="navbar-toggle collapsed" type="button">
					<i class="fa fa-reorder"></i>
				</button>
				<a href="http://www.pudn.com" class="navbar-brand">联合开发网</a>
			</div>
			<div class="navbar-collapse collapse" id="navbar">
				<ul class="nav navbar-nav">
					<li>
						<a href="/" style="padding-right:8px;padding-left:8px;font-size:16px">首页</a>
					</li>
					<li>
						<a href="https://search.pudn.com" style="padding-right:8px;padding-left:8px;font-size:16px">搜索</a>
					</li>
				</ul>
               	<ul class="nav navbar-top-links navbar-right">
               							<li>
                       	<a href="/User/login.html">
                           	&nbsp; <i class="fa fa-sign-out"></i>登录
                       	</a>
                   	</li>
                   	<li>
                       	<a href="/User/reg.html"><i class="fa fa-sign-out"></i>注册
                       	</a>
                   	</li>
					               	</ul>
			</div>
		</nav>
	</div>
	<form action="https://search.pudn.com/Download" method="get">
	<div class="top-menu-line2">
		<div class="my-container">
			<a href=/Download/upload.html>上传</a>
			&nbsp; <a href=/User>管理</a>
			&nbsp; <a href=https://search.pudn.com/Download>搜索</a>
			&nbsp; <a href=/Guestbook>留言</a>
			<div class="input-group pull-right" style="max-width:200px;margin:3px 15px 0px 0px">
				<input type="text" name="keyword" maxlength=20 placeholder="请输入关键字" class="form-control input-sm">
				<span class="input-group-btn"> <button type="submit" class="btn btn-white input-sm" style="border:1px solid #AAA"><i class="fa fa-search"></i></button>
				</span>
			</div>
		</div>
	</div></form>



<div class="row wrapper white-bg">
	<div class="my-container">
			<div class="nav-dir" style="padding:10px 0px">
				<a href="/">Pudn.com</a>&nbsp;&gt;&nbsp;下载中心
				&nbsp;&gt;&nbsp;音频处理				&nbsp;&gt;&nbsp;<font color=red>ESP8266_VGM_Player_PSG_YM2612</font>
			</div>


		<div class="row">
			<div class="col-xs-12 col-md-8">
				<div class="item-name">ESP8266_VGM_Player_PSG_YM2612</div>
				<div class="item-keyword">
									</div>
				<div class="item-action">
					<div class="btn-group">
						<a href=/Download/dl/id/1696772186700853 target=_blank class="btn btn-primary btn-sm">去下载(<span id="down-count">0</span>)</a>
						<a href="###" class="btn btn-white btn-sm vote-up"><i class="fa fa-thumbs-up"></i> 赞(<span id="vote-up-count">29</span>) </a>
						<a href="###" class="btn btn-white btn-sm vote-down"><i class="fa fa-thumbs-down"></i> 踩(<span id="vote-down-count">0</span>) </a>
						<a href="/Download/comment/id/1696772186700853" data-toggle="modal" data-target="#myModal" class="btn btn-white btn-sm"><i class="fa fa-comment"></i> 评论(<span id="comment-count">0</span>) </a>
						<a href="###" class="btn btn-white btn-sm favor-item"><i class="fa fa-heart"></i> 收藏(<span id="favor-count">0</span>) </a>
					</div>
				</div>
				<hr>

				<div class="item-info">
					<B>所属分类</B>：音频处理<BR>
					<B>开发工具</B>：C<BR>
					<B>文件大小</B>：0KB<BR>
					<B>下载次数</B>：0<BR>
					<B>上传日期</B>：2018-03-25 06:27:05<BR>
					<B>上 传 者</B>：<a href=/User/profile/id/1682139907912860.html>sh-1993</a><BR>
				</div>
				<div class="item-intro">
					说明：&nbsp;&nbsp;VGM（视频游戏音乐）播放器，采用世嘉Genesis的YM2612和SN76489 PSG。，<BR>(A VGM (Video Game Music) player featuring the YM2612 and SN76489 PSG from the Sega Genesis.,)				</div>
				<hr>
				<div><B>文件列表</B>: </div>
				<div id="file-list">
				16F690_SPI_LTC6903_Setclock/ (0, 2018-03-24)<BR>16F690_SPI_LTC6903_Setclock/__history/ (0, 2018-03-24)<BR>16F690_SPI_LTC6903_Setclock/__history/main.c.<B>~10~</B> (579, 2018-03-24)<BR>16F690_SPI_LTC6903_Setclock/__history/main.c.<B>~11~</B> (581, 2018-03-24)<BR>16F690_SPI_LTC6903_Setclock/__history/main.c.<B>~12~</B> (579, 2018-03-24)<BR>16F690_SPI_LTC6903_Setclock/__history/main.c.<B>~13~</B> (581, 2018-03-24)<BR>16F690_SPI_LTC6903_Setclock/__history/main.c.<B>~14~</B> (579, 2018-03-24)<BR>16F690_SPI_LTC6903_Setclock/__history/main.c.<B>~15~</B> (597, 2018-03-24)<BR>16F690_SPI_LTC6903_Setclock/__history/main.c.<B>~16~</B> (597, 2018-03-24)<BR>16F690_SPI_LTC6903_Setclock/__history/main.c.<B>~17~</B> (599, 2018-03-24)<BR>16F690_SPI_LTC6903_Setclock/__history/main.c.<B>~18~</B> (595, 2018-03-24)<BR>16F690_SPI_LTC6903_Setclock/__history/main.c.<B>~19~</B> (641, 2018-03-24)<BR>16F690_SPI_LTC6903_Setclock/__history/main.c.<B>~1~</B> (153, 2018-03-24)<BR>16F690_SPI_LTC6903_Setclock/__history/main.c.<B>~20~</B> (666, 2018-03-24)<BR>16F690_SPI_LTC6903_Setclock/__history/main.c.<B>~2~</B> (556, 2018-03-24)<BR>16F690_SPI_LTC6903_Setclock/__history/main.c.<B>~3~</B> (603, 2018-03-24)<BR>16F690_SPI_LTC6903_Setclock/__history/main.c.<B>~4~</B> (458, 2018-03-24)<BR>16F690_SPI_LTC6903_Setclock/__history/main.c.<B>~5~</B> (468, 2018-03-24)<BR>16F690_SPI_LTC6903_Setclock/__history/main.c.<B>~6~</B> (438, 2018-03-24)<BR>16F690_SPI_LTC6903_Setclock/__history/main.c.<B>~7~</B> (474, 2018-03-24)<BR>16F690_SPI_LTC6903_Setclock/__history/main.c.<B>~8~</B> (504, 2018-03-24)<BR>16F690_SPI_LTC6903_Setclock/__history/main.c.<B>~9~</B> (579, 2018-03-24)<BR>16F690_SPI_LTC6903_Setclock/__history/main.h.<B>~1~</B> (172, 2018-03-24)<BR>16F690_SPI_LTC6903_Setclock/main.<B>STA</B> (1353, 2018-03-24)<BR>16F690_SPI_LTC6903_Setclock/main.<B>c</B> (668, 2018-03-24)<BR>16F690_SPI_LTC6903_Setclock/main.<B>ccspjt</B> (450, 2018-03-24)<BR>16F690_SPI_LTC6903_Setclock/main.<B>cof</B> (52839, 2018-03-24)<BR>16F690_SPI_LTC6903_Setclock/main.<B>err</B> (96, 2018-03-24)<BR>16F690_SPI_LTC6903_Setclock/main.<B>esym</B> (34775, 2018-03-24)<BR>16F690_SPI_LTC6903_Setclock/main.<B>h</B> (177, 2018-03-24)<BR>16F690_SPI_LTC6903_Setclock/main.<B>hex</B> (1381, 2018-03-24)<BR>16F690_SPI_LTC6903_Setclock/main.<B>lst</B> (6701, 2018-03-24)<BR>16F690_SPI_LTC6903_Setclock/main.<B>sym</B> (1724, 2018-03-24)<BR>16F690_SPI_LTC6903_Setclock/main.<B>tre</B> (534, 2018-03-24)<BR>16F690_SPI_LTC6903_Setclock/main.<B>xsym</B> (3020, 2018-03-24)<BR>ESP8266_VGM_Player_PSG_YM2612.<B>ino</B> (12455, 2018-03-24)<BR>LICENSE (34500, 2018-03-24)<BR>SchematicsAndInfo/ (0, 2018-03-24)<BR>... ...<BR>				</div>
				<hr>
				<div id="readme">
				# ESP8266 VGM Player PSG YM2612

A new version of this project based on the Teensy 3.5 is now under development here: https://github.com/AidanHockey5/Teensy_3_5_VGM_Player_YM2612_SN76489/tree/master

Video of this project in action can be seen here: https://youtu.be/KguRHrbGrXg

More information can be found here: http://www.aidanlawrence.com/hardware-sega-genesis-video-game-music-player/

A VGM (Video Game Music) player featuring the YM2612 and SN76489 PSG from the Sega Genesis. I use a NodeMCU board to host the ESP8266

This project is an extention of my previous [PSG-only VGM player.](https://github.com/AidanHockey5/ESP8266_VGM_Player) 

# Information about the main sound chips and VGM

The YM2612, AKA OPN2 (FM Operator, type N), is a frequency modulation synthesizer that was found in the Sega Genesis. With the exception of a few scraps of information online, this chip has mainly been lost to time. There is no official data sheet and Yamaha semiconductor no longer holds records of them. It was quite a challenge to get anything out of this chip, much less a full VGM file player.

The SN76489, AKA PSG (Programmable Sound Generator), is a simple 3-square wave channel, 1-noise channel sound chip that was a staple in early home computers and video game consoles. It was most notably found in the Sega Master System - the predecessor of the Sega Genesis/Megadrive.

VGM stands for Video Game Music, and it is a 44.1KHz logging format that stores real soundchip register information. My player will parse these files and send the data to the appropriate chips. You can learn more about the VGM file format here: http://www.smspower.org/Music/VGMFileFormat

http://www.smspower.org/uploads/Music/vgmspec170.txt?sid=58da937e68300c059412b536d4db2ca0

# Hooking Everything Up
Because of limited IO on the ESP8266, I needed to control the sound chips via SN74HC595 shift registers. There are three shift registers: One for PSG data, one for YM2612 data, and one for controlling both chips. There is also two LTC6903 programmable oscillators that are programmed on power-up by a PIC16F690 chip. You don't need to use these specific chips for clocking, you just need to generate a 7.67 MHz signal for the YM2612 and a 3.58 MHz signal for the PSG. Crystals in these frequencies may be tricky to find, hence the LTC6903's.
I also reccomend heavy power filtering with large value capacitors (1000uF-2200uF), especially near the super sensitive YM2612 power pins. These old chips are power hogs, so external power will be required on top of plugging in the ESP8266 to USB.

Here is how to connect the ESP8266 to the shift registers:

ESP8266 | YM2612 Data Shift Register
------------ | -------------
D0 | Latch (12)
D1 | SRClock (11)
D2 | SERdata (14)

ESP8266 | Control Shift Register
------------ | -------------
D3 | Latch (12)
D4 | SRClock (11)
D5 | SERdata (14)

ESP8266 | PSG Data Shift Register
------------ | -------------
D6 | Latch (12)
D7 | SRClock (11)
D8 | SERdata (14)


---------------------------------------------------------------------------------------------------------------

Connect the data registers like this:

YM2612 Data Shift Register | YM2612
------------ | -------------
QA-QH | D0-D7

PSG Data Shift Register | SN76489 PSG
------------ | -------------
QA-QH | D0-D7

---------------------------------------------------------------------------------------------------------------

Connect the control register like this:

Control Shift Register | PSG & YM2612
------------ | -------------
QA | PSG WE
QB | YM2612 IC
QC | YM2612 CS
QD | YM2612 WR
QE | YM2612 RD
QF | YM2612 A0
QG | YM2612 A1
QH | NO CONNECTION

Clock hookups and other supporting connections can be viewed in the schematic below.

---------------------------------------------------------------------------------------------------------------

# Schematic
![Schematic](https://github.com/AidanHockey5/ESP8266_VGM_Player_PSG_YM2612/raw/master/SchematicsAndInfo/ESP8266_YM2612_SN76489_VGM_Player.svg.png)

[Vector version here](https://github.com/AidanHockey5/ESP8266_VGM_Player_PSG_YM2612/raw/master/SchematicsAndInfo/ESP8266_YM2612_SN76489_VGM_Player.svg)

[PDF](https://github.com/AidanHockey5/ESP8266_VGM_Player_PSG_YM2612/raw/master/SchematicsAndInfo/ESP8266_YM2612_SN76489_VGM_Player.pdf)

I did not include the LEDs in this schematic for simplicities sake. If you want them, just wire up the LEDs on the same pins as the shift register outputs with 220 OHM resistors in series. 

# ESP8266 Compile Settings
Board -> NodeMCU 1.0 (ESP-12E Module)

Flash Size -> 4M (3M SPIFFS)

CPU Frequency -> 160MHz

# How to Upload New VGM Files

This project will only parse uncompressed VGM format files. Directly sticking in a .VGZ file WILL NOT WORK! Instead, use [7Zip](http://www.7-zip.org/download.html) to extract the file from VGZ archives. You can find VGM music on several sites, http://project2612.org/list.php is my favorite.

Once you have your VGM files of choice, enter the sketch folder of this project and look for the "data" folder. Add your uncompressed VGM files here. Make sure to rename them to "1.vgm, 2.vgm, 3.vgm... etc." Make sure to change 
    const int NUMBER_OF_FILES
to match the number of files you have.
The ESP8266 can only hold about 2.5MB worth of data in the SPIFFS file system, so don't go too nuts! (Usually around 7 songs works).

After that, upload your files using the SPIFFS upload tool which you can find here: http://esp8266.github.io/Arduino/versions/2.0.0/doc/filesystem.html

# Pause, Play, Forward Song, Previous Song
You can simply use the serial port for these commands. Consult the table below:

Action | Command
------------ | -------------
Pause/Play | \*
Next Song | +
Previous Song | -

...Or, you could wire up an external UART device to send those characters over to the RX pin of the ESP8266. Transmitting device is connected via TX, ESP8266 is connected via RX. Make sure to remove these UART connections while programming/uploading songs.

# Limitations
Because this project runs off of three shift registers, songs with heavy amounts of PCM sample usage may sound slow or distorted. The only way around this would be to have more direct IO on the ESP8266... which we can't have. I plan to release a faster version of this project based on the ESP32 module once SPIFFS is released for it.

# Shout-outs
Thank you so much for the help, [Jarek](https://hackaday.io/Jarek)! I wouldn't have been able to do this without your amazing documentation and assistance! [Check out his version of a hardware VGM player here!](https://hackaday.io/project/13361-sega-genesis-native-hardware-chiptune-synthesizer)

				</div>
				<hr>
				<div><B>近期下载者</B>：</div>
				<div id="download-users"></div>
				<hr>
				<div><B>相关文件</B>：</div>
				<div id="relate-items"></div>
				<hr>
				<div><B>评论</B>：[<a href=/Download/comment/id/1696772186700853.html data-toggle=modal data-target="#myModal">我要评论</a>]&nbsp;[<a class='pop-a' href=/Download/report/id/1696772186700853.html>举报此文件</a>]</div>
				<div id="file-comments"></div>
				<hr>
				<div><B>收藏者</B>：</div>
				<div id="favor-users"></div>
				<p></p>
			</div>

			<div class="col-xs-12 col-md-4">

				<div class="ad-sidebar text-center">
					<div class="ad-300">
					</div>
				</div>
			</div>
		</div>

	</div>
</div>



	<div class="my-footer">
		<div class="container">
		<div class="pull-right">
		</div>

		<div>
			
			<a href="http://www.pudn.com" target=_blank>© 联合开发网 from 2004</a> | 
			<a href="/Index/contact.html">联系站长</a> | 
			<a href=" https://beian.miit.gov.cn" target=_blank>湘ICP备2023001425号</a> | 
			<a href="http://www.beian.gov.cn/portal/registerSystemInfo?recordcode=43010502000604" target=_blank>网安备43010502000604</a> | 
		</div>
		</div>
	</div>


</div><!-- /wrapper-->




<!-- page specific plugin scripts -->

<!-- inline scripts related to this page -->

<div id="myModal" class="modal fade" tabindex="-1" 
			role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
	<div class="modal-dialog">
		<div class="modal-content">
			
		</div>
	</div>
</div><!-- /.modal-table -->

</body>

<script type="text/javascript">
$(document).on('click', '.list-more', function(){
	var id=$(this).attr('data-id');
	$('#list-'+id).css('max-height',$('#list-'+id)[0].scrollHeight);
	$(this).removeClass('list-more');
	$(this).addClass('list-hide');
	$(this).html('<i class="fa fa-angle-double-up"></i>');
	
	//$(this).hide();

	return false;
});

$(document).on('click', '.list-hide', function(){
	var id=$(this).attr('data-id');
	$('#list-'+id).css('max-height','100px');
	$(this).removeClass('list-hide');
	$(this).addClass('list-more');
	$(this).html('<i class="fa fa-angle-double-down"></i>');
	
	return false;
});

$("#myModal").on("hidden.bs.modal", function() {
    $(this).removeData();
});

$(document).on("click",".keyword",function(){
	var keyword=$(this).attr("keyword");
	var type_id=$(this).attr("type_id");
	if(typeof(type_id) =="undefined" || type_id =="") type_id="0";
	location.href="http://search.pudn.com/Download/index?keyword="+keyword;
	
	return false;
});
</script>
<script type="text/javascript" src="/js/time.js"></script>


<script type="text/javascript" src="/js/marked.min.js"></script>
<script type="text/javascript">
	$(document).ready(function(){
		$('.hide-list').each(function(){
			if ($(this)[0].offsetHeight < $(this)[0].scrollHeight){
				var id=$(this).attr('id');
				id =id.substring(5);
				$(this).after('<div style="text-align:center"><a href="" class="list-more" data-id="' + id + '"><i class="fa fa-angle-double-down"></i></a></div>');
			}
		});
	});
	var g_id="1696772186700853";
	var keywords =new Array();
		function get_download_user(){
		var url ="/Download/get_download_user/id/"+g_id+".html";
		$.get(url,function(ret){
			if(ret.length ==0) return;
			var html='';
			for(i in ret){
				html =html + '<a href=/User/profile/id/'+ret[i].user_new_id+'.html>'+ret[i].name+'</a> ';
			}
			$('#download-users').append(html);
		});
	}
	
	function get_relate_item(){
		var url ="/Download/get_relate_item/id/"+g_id+'.html';
		$.get(url,function(ret){
			if(ret.length ==0) return;
			var html='';
			var intro;
			for(i in ret){
				intro =ret[i].intro;
				for(j in keywords){
					var reg =new RegExp(keywords[j],'gmi');
					intro =intro.replace(reg,'<font color=brown>'+keywords[j]+'</font>');
				}
				html =html + '[<a href=/Download/item/id/'+ret[i].new_id+'.html>'+ret[i].name+'</a>]&nbsp; '+intro+'<BR>';
			}
			$('#relate-items').append(html);
		});
		
	}
	function get_score_name(score){
		switch(score){
		case '100': return '很好，推荐下载';
		case '85': return '还不错';
		case '75': return '一般，勉强可用';
		case '50': return '差';
		case '3': return '纯粹是垃圾';
		case '40': return '和说明完全不符';
		case '20': return '文件不全';
		case '10': return '不是源代码或资料';
		case '5': return '文件有密码，不知道密码';
		case '0': return '不能解压或下载失败';
		}
		return '';
	}
	function get_comment(){
		var url ="/Download/get_comments/id/"+g_id+'.html';
		$.get(url,function(ret){
			if(ret.length ==0) return;
			var total_count =ret.total_count;
			var data =ret.data;
			var html='';
			for(i in data){
				html =html + '<a href="/User/profile/id/'+data[i].user_new_id+'.html" class="uploader">'+data[i].user_name+'</a>: <span class="comment-score">'+get_score_name(data[i].score)+'</span>, '+data[i].content+'<BR>';
			}
			$('#file-comments').append(html);
		});
		
	}
	function get_favor(){
		var url ="/Download/get_item_favors/id/"+g_id+".html";
		$.get(url,function(ret){
			if(ret.length ==0) return;
			var html='';
			for(i in ret){
				html =html + '<a href=/User/profile/id/'+ret[i].user_new_id+'.html class=user>'+ret[i].name+'</a>&nbsp;';
			}
			$('#favor-users').html(html);
		});
	}
	// 得到下载这个的用户又下载了什么
	function get_more_download(){
		
	}
	// 得到下载这个的用户又搜索了什么
	function get_more_keyword(){
		
	}
	
	// 得到论坛相关问题
	function get_bbs(){
		
	}
	
	// 得到软件工场相关内容
	function get_works(){
		
	}
	
	// 得到相关聊天室
	function get_chat(){
		
	}
	
	// 得到相关软件商城信息
	function get_shop(){
		
	}
	
	// 得到job
	
	// 得到学习内容

	// 数据
	get_download_user();
	//get_relate_item();
	get_comment();
	get_favor();
	
	$('.vote-up').click(function(){
		var url="/Download/vote/t/up/id/"+g_id;
		$.get(url,function(ret){
			if(ret.status==0){
				alert(ret.info);
				if(ret.url.length >0)
					location.href=ret.url;
			}
			else{
				var s =$('#vote-up-count').html();
				if(s =='') s="0";
				var count =parseInt(s)+1;
				$('#vote-up-count').html(count);
			}
		})
		return false;
	});
	$('.vote-down').click(function(){
		var url="/Download/vote/t/down/id/"+g_id;
		$.get(url,function(ret){
			if(ret.status==0)
				alert(ret.info);
			else{
				var s =$('#vote-down-count').html();
				if(s =='') s="0";
				var count =parseInt(s)+1;
				$('#vote-down-count').html(count);
			}
		})
		return false;
	});
	$('.favor-item').click(function(){
		var url="/Favor/add/t/0/id/"+g_id;
		$.get(url,function(ret){
			if(ret.status==0){
				alert(ret.info);
			}
			else{
				var s =$('#favor-count').html();
				if(s =='') s="0";
				var count =parseInt(s)+1;
				$('#favor-count').html(count);
			}
		})
		return false;
	});
	$('.pop-a').click(function(){
		var url=$(this).attr('href');
		$.get(url,function(ret){
			alert(ret.info);
			//location.reload();
		})
		return false;
	});

document.getElementById('readme').innerHTML =marked.parse(document.getElementById('readme').innerHTML);
</script>



</html>