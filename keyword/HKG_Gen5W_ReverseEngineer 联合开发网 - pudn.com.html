
<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>HKG_Gen5W_ReverseEngineer 联合开发网 - pudn.com</title>

    <link href="/Public/m/css/bootstrap.min.css" rel="stylesheet">
    <link href="/Public/m/font-awesome/css/font-awesome.css" rel="stylesheet">

    <link href="/Public/m/css/animate.css" rel="stylesheet">
    <link href="/Public/m/css/style.css" rel="stylesheet">

	<link href="/Public/m/css/plugins/slick/slick.css" rel="stylesheet">
	<link href="/Public/m/css/plugins/slick/slick-theme.css" rel="stylesheet">

	

	<link href="/css/style.css" rel="stylesheet">

	<!-- Mainly scripts -->
	<script src="/Public/m/js/jquery-2.1.1.js"></script>
	<script src="/Public/m/js/bootstrap.min.js"></script>

	<script src="/Public/m/js/plugins/metisMenu/jquery.metisMenu.js"></script>
	<script src="/Public/m/js/plugins/slimscroll/jquery.slimscroll.min.js"></script>

	<!-- Custom and plugin javascript -->
	<script src="/Public/m/js/inspinia.js"></script>
	<script src="/Public/m/js/plugins/pace/pace.min.js"></script>
	
<META name="Keywords" content="HKG_Gen5W_ReverseEngineer 程序员 编程 源码 源代码 下载">

	
<META name="Description" content="HKG_Gen5W_ReverseEngineer Reverse Engineering Hyundai/Kia/Genesis Gen5W Firmware, stars:1, update:2024-06-02 00:00:18">

</head>

<body>

<!-- /.main-container start -->

<div class="pace  pace-inactive">
  	<div class="pace-progress" data-progress-text="100%" data-progress="99" style="transform: translate3d(100%, 0px, 0px);">
  	<div class="pace-progress-inner"></div>
	</div>
	<div class="pace-activity"></div>
</div>

<div class="all-content">
	<div class="my-container top-navigation">
		<nav class="navbar navbar-static-top" role="navigation">
			<div class="navbar-header">
				<button aria-controls="navbar" aria-expanded="false" data-target="#navbar" data-toggle="collapse" class="navbar-toggle collapsed" type="button">
					<i class="fa fa-reorder"></i>
				</button>
				<a href="http://www.pudn.com" class="navbar-brand">联合开发网</a>
			</div>
			<div class="navbar-collapse collapse" id="navbar">
				<ul class="nav navbar-nav">
					<li>
						<a href="/" style="padding-right:8px;padding-left:8px;font-size:16px">首页</a>
					</li>
					<li>
						<a href="https://search.pudn.com" style="padding-right:8px;padding-left:8px;font-size:16px">搜索</a>
					</li>
				</ul>
               	<ul class="nav navbar-top-links navbar-right">
               							<li>
                       	<a href="/User/login.html">
                           	&nbsp; <i class="fa fa-sign-out"></i>登录
                       	</a>
                   	</li>
                   	<li>
                       	<a href="/User/reg.html"><i class="fa fa-sign-out"></i>注册
                       	</a>
                   	</li>
					               	</ul>
			</div>
		</nav>
	</div>
	<form action="https://search.pudn.com/Download" method="get">
	<div class="top-menu-line2">
		<div class="my-container">
			<a href=/Download/upload.html>上传</a>
			&nbsp; <a href=/User>管理</a>
			&nbsp; <a href=https://search.pudn.com/Download>搜索</a>
			&nbsp; <a href=/Guestbook>留言</a>
			<div class="input-group pull-right" style="max-width:200px;margin:3px 15px 0px 0px">
				<input type="text" name="keyword" maxlength=20 placeholder="请输入关键字" class="form-control input-sm">
				<span class="input-group-btn"> <button type="submit" class="btn btn-white input-sm" style="border:1px solid #AAA"><i class="fa fa-search"></i></button>
				</span>
			</div>
		</div>
	</div></form>



<div class="row wrapper white-bg">
	<div class="my-container">
			<div class="nav-dir" style="padding:10px 0px">
				<a href="/">Pudn.com</a>&nbsp;&gt;&nbsp;下载中心
				&nbsp;&gt;&nbsp;项目开发与运营				&nbsp;&gt;&nbsp;<font color=red>HKG_Gen5W_ReverseEngineer</font>
			</div>


		<div class="row">
			<div class="col-xs-12 col-md-8">
				<div class="item-name">HKG_Gen5W_ReverseEngineer</div>
				<div class="item-keyword">
									</div>
				<div class="item-action">
					<div class="btn-group">
						<a href=/Download/dl/id/1717428084866022 target=_blank class="btn btn-primary btn-sm">去下载(<span id="down-count">0</span>)</a>
						<a href="###" class="btn btn-white btn-sm vote-up"><i class="fa fa-thumbs-up"></i> 赞(<span id="vote-up-count">0</span>) </a>
						<a href="###" class="btn btn-white btn-sm vote-down"><i class="fa fa-thumbs-down"></i> 踩(<span id="vote-down-count">0</span>) </a>
						<a href="/Download/comment/id/1717428084866022" data-toggle="modal" data-target="#myModal" class="btn btn-white btn-sm"><i class="fa fa-comment"></i> 评论(<span id="comment-count">0</span>) </a>
						<a href="###" class="btn btn-white btn-sm favor-item"><i class="fa fa-heart"></i> 收藏(<span id="favor-count">0</span>) </a>
					</div>
				</div>
				<hr>

				<div class="item-info">
					<B>所属分类</B>：项目开发与运营<BR>
					<B>开发工具</B>：C<BR>
					<B>文件大小</B>：0KB<BR>
					<B>下载次数</B>：0<BR>
					<B>上传日期</B>：2024-06-03 23:21:24<BR>
					<B>上 传 者</B>：<a href=/User/profile/id/1682139907912860.html>sh-1993</a><BR>
				</div>
				<div class="item-intro">
					说明：&nbsp;&nbsp;Reverse Engineering Hyundai/Kia/Genesis Gen5W Firmware, stars:1, update:2024-06-02 00:00:18				</div>
				<hr>
				<div><B>文件列表</B>: </div>
				<div id="file-list">
				cwm_tcc897x.img<BR>tc-write-misc.c<BR>				</div>
				<hr>
				<div id="readme">
				# Reverse Engineering Hyundai/Kia/Genesis Android-based Gen5W Head-Units

Hyundai/Kia/Genesis cars have a few different types (generations) for their Head-Units (infotainment systems).  
Most of the wide-screen Head Units since 2019 are from GEN5W which can be either based on Android or based on Linux (ccOS) - both get periodic firmware updates that can be updated using a USB drive. This page is about reverse engineering the GEN5W Android Head-Units, patching their official firmwares to get adb, root, modify stock apks, and install third-party apks.

## Some history, credits, and references.

A few months ago when I got my new car I decided to hack into the Head-Unit (HU) to add some apps and customize some stuff - and this sent me back (after so many years) into the fantastic world of reverse-engineering and Android hacking. 

The first page I found about hacking Hyundai HUs was an old XDA thread with some discussions about how to enter engineering mode, how to enable adb, how third-party APKs were blocked, etc - but most of those findings were for old generations or for very old firmware versions and weren't working anymore. The real useful information was mostly found in Telegram/Discord groups:
- [Ioniq Dev Telegram Group](https://t.me/+GeTwB_AD7utjNmVk) is very active and has tons of information. Unfortunately this group is for **Gen5 Linux (not Android)**, but yet many ideas and tricks work similar for Gen5/Gen5W-Linux/Gen5W-Android. Some members of this group published some [interesting findings](https://gitlab.com/g4933/wideopen/-/tree/main), like the fact that firmware updates are encrypted using AES secret key, files are hashed, hashes are signed using RSA public-key cryptography, and they also found some methods to bypass the RSA checks.  
  Around early 2022 they found a way to do [ELF patching](https://gitlab.com/g4933/gen5w/navi_extended/-/blob/main/appnavi_payload_injector_patch/full_patcher_commented.sh) to inject [assembly code](https://gitlab.com/g4933/gen5w/navi_extended/-/blob/main/appnavi_payload_injector_patch/payload.s) into the navigation-app libraries, and this assembly-hook could run arbitrary commands (reading scripts from USB drive).  
- [KIA/Hyundai Android Modd](https://t.me/+1E4AJutHbvhkZjU1) is focused on Gen5-Android. Someone in that group had old firmware (where adb could still be enabled from engineering menu, and engineering menu password was historically leaked), and [Helloyunho](https://github.com/Helloyunho) asked this person to share some files like `uagentd`, `/etc/image.dat` (secret key), etc. By reverse engineering (and logs) she discovered that the navigation app did NOT had a RSA-signature validation, which means it was a good candidate for being tampered.
- [Helloyunho created an exploit for Gen5W-Androids](https://github.com/Helloyunho/gen5w-utils) based on the same idea (patching ELF Navi-libraries with C-code to run arbitrary scripts), and created a great [Gen5W Android Discord Group](https://discord.gg/KpwrAeHmQJ).  
Most things described in this page are things I learned in this Discord Group enriched with a few contributions on my own.  
Special thanks to Helloyunho, superdavex, UnjustifiedDev, and so many others who contributed to the group.


If you are looking for information on D-Audio2 generation check [greenluigi](https://programmingwithstyle.com/posts/howihackedmycar/) the series of posts [How I Hacked My Car](https://programmingwithstyle.com/posts/howihackedmycar/) (source code [here](https://github.com/greenluigi1/HyundaiFirmwareDecrypter)).  For D-Audio (v1) check [xakcop](https://xakcop.com/post/hyundai-hack/). Both were still based on password-protected ZIP file. For Gen5 (not Gen5W) check [Radoslav Gerganov](https://github.com/rgerganov/gen5fw).



## Limitations

There are some important limitations on what can currently be done:
- Gen5W is based on Android 4.4.2 (with some modifications) but Hyundai Mobis didn't made the full source code available (by the license agreement I think they should?).
- Without the right audio/video drivers it's impossible to rebuild a new working kernel, add new hardware modules, or upgrade to more recent Android versions.
- Google Play Services (part of `services.jar`) is blocked, and we can't just unblock it because they doesn't support Android 4.x anymore.  
  This means: no YouTube, no Google Play Store, no Gmail, Google Maps cannot load your profile/favorites.
- Some models do not have Wifi Module (but apps can use the modem internet if available).  
  I haven't yet found a way to install external wi-fi adapters, but I heard it's possible. 

If you want a full modern Android (to watch YouTube or any other recent apps), I suggest that you should buy an AI box like [CarlinKit](https://carlinkitcarplay.com/collections/carplay-ai-box), or [any other](https://www.amazon.com/s?k=car+ai+box).

## Requirements

In order to apply the methods described here you'll need:
- A Linux machine (can be a VM)
- One 64gb USB drive (maybe two if you have a recent firmware)
- Laptop (Windows is recommended) with Android USB Drivers and Tools (adb/fastboot).
- Male-to-male USB cable (to connect Laptop to Head Unit)

## How Firmware Updates Works

Firmware updates are basically TAR archives that can be downloaded and saved in a USB drive.

These tar archives contain some "core" files that are directly flashed as Android partitions:
- `boot` partition (contains Android kernel/OS/drivers), `system` partition (filesystem/apps), `recovery` partition (code to install new firmware updates from USB drive), `lk` (bootloader / little kernel), modem firmware, micom, etc.
- **Those partitions are all encrypted using AES-128-CBC**.
- Example: `/enc_system/enc_boot.img` is decrypted into `boot.img` that is flashed into `/boot` partition
- The secret key is **NOT** the same for all car models
- This key can be found in `/system/etc/image.dat` (it's the first 32 chars), after you get access to your HU

These tar archives also contain navigation app and maps stored in other tar files (`navi_backup.tar*` and `sw_backup.tar`):
- These files are basically just extracted on top of `/navi` partition (it's a partition only for navigation software)
- Some files in the tar are just unencrypted
- Executable files (or libs) are encrypted using AES-128-CBC
- The secret key is the SAME for EVERY Hyundai/Kia/Genesis car model (spoiler: it was [leaked](https://github.com/Helloyunho/gen5w-utils/blob/main/decrypt_navi.py))

On top of AES encryption there's also RSA-signatures:
- All files are hashed using SHA-224
- A digest of all hashes is encrypted using a lame XOR cryptography
- This digest is signed using RSA (only Hyundai has the private key, so we can't fake that signature)
- Updater programs will check if the RSA signature is authentic (using the corresponding public key, baked into the filesystem)
- Updater programs also checks (well, mostly) if the hashes in the signed digest are still matching the hashes of the actual files

The update process starts in the UI - we enter Settings menu and click Update button:
- Settings app communicates with `uagentd` (Update Agent Daemon), which will check USB drive, check RSA signature (both check if it's authentic and also check if the current hashes match what was signed)
- If everything looks good it will reboot into `recovery` mode.

The second part of the update process happens in recovery mode (`/sbin/recovery` from `recovery` partition):
- It will check RSA signature again (both check if it's authentic and also check if the current hashes match what was signed)
- It will decrypt the partitions and flash them one by one
- It will extract navigation tars (including `sw_backup.tar`) and decrypt the encrypted parts


## Main Exploit: How it Works

The major security flaw was discovered by [Helloyunho](https://github.com/Helloyunho/gen5w-utils) by disassembling `uagentd`/`recovery` and analyzing recovery logs:
- `uagentd` was NOT checking the `sw_backup.tar` hash, so that file can be tampered and doesn't need to match the hash that RSA-signed (currently this was fixed but there's still a hack to bypass that)
- `recovery` does NOT check `sw_backup.tar` hash either (still doesn't!)
- Encrypted files in `sw_backup.tar` are decrypted with a secret key that could be retrieved from the binaries - and now it has been [leaked](https://github.com/Helloyunho/gen5w-utils/blob/main/decrypt_navi.py)

Then being able to decrypt/encrypt navigator libraries she created the main exploit, based on method hooking:
- There is a [hook](https://github.com/Helloyunho/gen5w-utils/blob/main/hook.c) method that will look for a [shell script](https://github.com/Helloyunho/gen5w-utils/blob/main/run.sh) in your USB drive and will [invoke](https://github.com/Helloyunho/gen5w-utils/blob/main/hook.c#L255) it - allows you to run arbitrary code in the Android HU
- There is a Python code that can [patch](https://github.com/Helloyunho/gen5w-utils/blob/main/patch_navi.py) any ELF-method with the new code. So basically when the original method is called the hook will run instead
- The [main Python script](https://github.com/Helloyunho/gen5w-utils/blob/main/make_patched_firmware.py) will [look for a logging library](https://github.com/Helloyunho/gen5w-utils/blob/main/make_patched_firmware.py#L92), decrypt it, patch existing methods with the hook, and reencrypt it.  
  Then it will rebuild the non-signed hash list with new `sw_backup.tar` hash (so the XOR'ed hashes-digest is recreated, but there's no need to recreate the respective RSA signature, since that specific hash isn't compared)

By being able to run arbitrary code we extract any files from the Head-Unit (including the other AES keys used to encrypt/decrypt all firmare files other than the navigation), we can enable adb (and get a shell), or enter bootloader (and flash anything), etc.

## Patching Stock Firmware with the Exploit

After downloading an official firmware (or using an old downloaded copy, even better) you can patch it with the exploit. The steps below should all be done under Linux (steps below were tested in Ubuntu 22.04).

1. Install Python, PIP and other dependencies:
    ```sh
    sudo apt update -y
    sudo apt upgrade -y
    sudo apt install make automake autoconf libtool unzip python3 python3-pip -y
    ```

1. Build libtar (the library AND the command-line utility):
    ```sh
    cd ~
    git clone https://github.com/Parrot-Developers/libtar.git
    
    # make the lib
    cd libtar
    aclocal
    autoconf
    ./configure
    make
    
    # make the binary utility (libtar cli)
    cd libtar
    make
    
    # add to path
    export PATH="$PATH:$HOME/libtar/libtar" # or (not persistent): PATH="$PATH:$HOME/libtar/libtar"
    ```

1. Download Android NDK r19:
    ```sh
    sudo mkdir /android/
    cd /android/
    sudo wget https://dl.google.com/android/repository/android-ndk-r19c-linux-x86_64.zip
    sudo unzip android-ndk-r19c-linux-x86_64.zip
    export NDK_ROOT=/android/android-ndk-r19c
    ```

1. Clone [Helloyunho repository](https://github.com/Helloyunho/gen5w-utils) and install dependencies:
    ```sh
    cd ~
    git clone https://github.com/Helloyunho/gen5w-utils.git
    cd ~/gen5w-utils
    python3 -m pip install -r requirements.txt
    ```

1. Build `hook.c` into `hook.o`:
    ```sh
    ./build_hook.sh
    ```
    The output (`hook.o`) is a binary object that will be injected (using [LIEF](https://github.com/lief-project/LIEF)) into a navigation-app library

1. Download [tc-write-misc.c](tc-write-misc.c?raw=true) utility and build it:    
    ```sh
    HOST_OS="$(uname -s | tr '[:upper:]' '[:lower:]')"
    HOST_ARCH="$(uname -m | tr '[:upper:]' '[:lower:]')"
    HOST_TAG="$HOST_OS-$HOST_ARCH"
    "$NDK_ROOT/toolchains/llvm/prebuilt/$HOST_TAG/bin/armv7a-linux-androideabi19-clang" -mthumb -fPIC -shared -fomit-frame-pointer -nostdlib -nodefaultlibs tc-write-misc.c -o tc-write-misc
    ```

1. Copy the downloaded firmware into some folder where we'll apply the patch (e.g. `/2023_Palisade_USA/`).  
   PS: You should do all these steps in a Linux filesystem (**POSIX-compliant**), if you try to patch firmware directly under the USB drive created by Navigation Updater (which only accepts FAT/NTFTS) it probably WON'T work, and you might get a bad tarfile.  
   PS: The only large file that you'll need is `sw_backup.tar`, so if you're copying firmware files to Linux to run the patching scripts you only have to copy this specific file and the other smaller files. After the patching process you can copy all these files (they will have been modified) back to the original place where you have all firmware files (probably an USB drive).

1. Now patch sw_backup.tar:  
  `python3 make_patched_firmware.py /2023_Palisade_USA/`  
  This will extract `sw_backup.tar`, find the right libraries to be patched, decrypt them, patch them with the hook, reencrypt, and will recalculate `sw_backup.tar` hash. The original RSA signature is preserved (as explained earlier the hash for tampered `sw_backup.tar` is not compared with whatever hash was signed)

1. Copy the firmware (with the modified files) to your USB drive.  
   Also copy `tc-write-misc` that you built (you'll need it later)

## Flashing the Patched Firmware (if your car has firmware older than Oct 2023)

If your car has old firmware (older than Oct 2023) you can just flash the patched firmware using the regular steps (Settings, Update button, etc.) - the HU will reboot and the update will proceed.

## Flashing the Patched Firmware (if your car has recent firmware)

In recent firmware versions (October 2023) `uagentd` was fixed to check `sw_backup.tar` hash (it should match what was signed by RSA private key). So basically a patched `sw_backup.tar` is NOT accepted anymore as valid. 

However `recovery` (which is where the real update occurs) still has a flaw, so there's a trick using two USB drives:
- In the first USB drive you copy the official firmware update (where `sw_backup.tar` matches the RSA-signed hashlist)
- In the the second one you put the patched firmware (with the recalculated hash for `sw_backup.tar`).  
  No need to create a new RSA signature (we wouldn't be able to do it anyway)
- In the Android UI we start the update process using the official firmware
- `uagent` will validate the RSA signature, check if the digest that was signed (a list of hashes) matches the real files (after they decrypted), and will reboot into recovery mode.
- When the HU reboots you should quickly swap USB drives
- During recovery mode `/sbin/recovery` will again validate RSA signature (check if it's authentic), decrypt files and check if the hashes in the signed digest matches the hashes from the real files. However `sw_backup.tar` is extracted under a different logic that still doesn't check if the signed-hash still matches the file hash. So update works and we can get our patched libraries.

## After you updated with Patched Firmware

Now that you have a patched firmware, every time you run navigation app the hooked-library will check if there is a script `run.sh` in the USB drive, and if the file exists then script will be executed.  

When the script is executed the hook saves a lock file in the USB drive, so if you need to run the script again you have to delete the lock file `XXlock` and launch navi again  
PS: in my experience sometimes you have to reboot the HU in order to stop navi process.

## Using Exploit for the First time

**\*\*IMPORTANT\*\*** - You'll need a Laptop (most people use Windows for this) and a male-to-male USB cable (to connect Laptop to Head Unit) - if you do not have that then do not proceed further (or at least do not enable adb).

The script [`run.sh`](https://github.com/Helloyunho/gen5w-utils/blob/main/run.sh) was automatically copied as part of `make_patched_firmware.py`, so probably that file is already in your USB drive.

Edit `run.sh` in your USB drive and replace it with the following:

   ```sh
  #!/system/bin/sh

  # Redirecting output to append to the file
  LOG_FILE="/storage/usb0/bash_log.txt"
  exec 1>"$LOG_FILE" 2>&1

  # COMMANDS
  echo "Copying recovery resources..." # this zip contains AES key and iv
  /system/bin/cp /system/etc/recovery-resource.dat /storage/usb0/recovery-resource.zip
  
  echo "Copying key/iv individually (if they exist)..."
  /system/bin/cp /system/etc/image*.dat /storage/usb0/
  /system/bin/cp /system/etc/iv*.dat /storage/usb0/

  echo "Pushing some utilities to the HU..." # copying to any writeable folder
  /system/bin/cp /storage/usb0/tc-write-misc /storage/navi/bin
  /system/bin/chmod 777 /storage/navi/bin/tc-write-misc 

  echo "backing-up boot.img..."
  /system/bin/dd if=/dev/block/platform/bdm/by-name/boot of=/storage/usb0/boot-backup.img
   ```

Plug that USB into your HU, and launch the navigator app (which may or may not start - don't worry, we can fix it later).  

Remove your USB drive and check if some files were copied there, as well as logs, and a lock file `XXlock`.

If everything worked fine, save those files (you'll need them later), and we can proceed with more tricks...

PS: Those files copied from HU to USB (`/system/etc/image.dat`, `/system/etc/iv.dat` if exists and `/system/etc/recovery-resource.dat`) are the AES key that can be used to decrypt all other firmware parts (other than navigation)

## Enabling ADB

Delete `XXlock`, edit `run.sh` and replace with the following commands:

   ```sh
  #!/system/bin/sh

  LOG_FILE="/storage/usb0/bash_log.txt"
  exec 1>"$LOG_FILE" 2>&1

  # COMMANDS
  echo "Enabling adb..."
  service call com.hkmc.misc 6 i32 5 # enables adb mode (usb drives wont work, android auto wont work)
  service call com.hkmc.misc 4 i32 4 # restart adb
  
  # as soon as we enable adb the USB drive will disconnect, 
  # so most likely log file will be empty this time
   ```

Launch navigator again. Remove USB drive and check for logs (no worry if it's empty) and for a new lockfile `XXLock`.  
If they are not there it means the hook didn't run - in this case reset the HU and try again (sometimes navi/lock freezes so you need to reboot)

If everything worked fine, you should be able to plug your Laptop and run `adb devices` and see the HU

## ADB

Now that you have `adb` enabled, you can connect from your laptop to the Head Unit.

I suggest Windows, but probably it should work with Linux/MacOS too.

For Windows you can get latest [Android Drivers here](https://developer.android.com/studio/run/win-usb) (latest_usb_driver_windows.zip).  
(I think that also contains tools you'll need like `adb.exe` and `fastboot.exe`)

Type `adb devices` to see if the connection is working.  
If it's not working probably you have bad drivers or a bad USB cable.

By typing `adb shell` you'll get a shell, but it's very limited since you don't have root yet (and important folders are all read-only).  

At this point (even without root) you can already upload some APKs (as long as they work with Android 4.4.2) to any writable folder - see later in this page.

PS: for now you should leave ADB enabled, BUT if you wanted to immediately disable it you could get an adb connection (`adb shell`) and run `service call com.hkmc.misc 6 i32 6` (sets back to host mode). (I think restarting adb with `service call com.hkmc.misc 4 i32 4` is probably not required).

## Important: Host Mode vs Acessory Mode

By enabling ADB the HU goes from **HOST MODE** to **ACCESSORY MODE**.

Accessory Mode means your Android HU is an accessory to something else (in case your Laptop running the adb client), so the following things will NOT work since they only work in HOST MODE:
- Your Android HU will not charge a connected phone (no po ... ...				</div>
				<hr>
				<div><B>近期下载者</B>：</div>
				<div id="download-users"></div>
				<hr>
				<div><B>相关文件</B>：</div>
				<div id="relate-items"></div>
				<hr>
				<div><B>评论</B>：[<a href=/Download/comment/id/1717428084866022.html data-toggle=modal data-target="#myModal">我要评论</a>]&nbsp;[<a class='pop-a' href=/Download/report/id/1717428084866022.html>举报此文件</a>]</div>
				<div id="file-comments"></div>
				<hr>
				<div><B>收藏者</B>：</div>
				<div id="favor-users"></div>
				<p></p>
			</div>

			<div class="col-xs-12 col-md-4">

				<div class="ad-sidebar text-center">
					<div class="ad-300">
					</div>
				</div>
			</div>
		</div>

	</div>
</div>



	<div class="my-footer">
		<div class="container">
		<div class="pull-right">
		</div>

		<div>
			
			<a href="http://www.pudn.com" target=_blank>© 联合开发网 from 2004</a> | 
			<a href="/Index/contact.html">联系站长</a> | 
			<a href=" https://beian.miit.gov.cn" target=_blank>湘ICP备2023001425号</a> | 
			<a href="http://www.beian.gov.cn/portal/registerSystemInfo?recordcode=43010502000604" target=_blank>网安备43010502000604</a> | 
		</div>
		</div>
	</div>


</div><!-- /wrapper-->




<!-- page specific plugin scripts -->

<!-- inline scripts related to this page -->

<div id="myModal" class="modal fade" tabindex="-1" 
			role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
	<div class="modal-dialog">
		<div class="modal-content">
			
		</div>
	</div>
</div><!-- /.modal-table -->

</body>

<script type="text/javascript">
$(document).on('click', '.list-more', function(){
	var id=$(this).attr('data-id');
	$('#list-'+id).css('max-height',$('#list-'+id)[0].scrollHeight);
	$(this).removeClass('list-more');
	$(this).addClass('list-hide');
	$(this).html('<i class="fa fa-angle-double-up"></i>');
	
	//$(this).hide();

	return false;
});

$(document).on('click', '.list-hide', function(){
	var id=$(this).attr('data-id');
	$('#list-'+id).css('max-height','100px');
	$(this).removeClass('list-hide');
	$(this).addClass('list-more');
	$(this).html('<i class="fa fa-angle-double-down"></i>');
	
	return false;
});

$("#myModal").on("hidden.bs.modal", function() {
    $(this).removeData();
});

$(document).on("click",".keyword",function(){
	var keyword=$(this).attr("keyword");
	var type_id=$(this).attr("type_id");
	if(typeof(type_id) =="undefined" || type_id =="") type_id="0";
	location.href="http://search.pudn.com/Download/index?keyword="+keyword;
	
	return false;
});
</script>
<script type="text/javascript" src="/js/time.js"></script>


<script type="text/javascript" src="/js/marked.min.js"></script>
<script type="text/javascript">
	$(document).ready(function(){
		$('.hide-list').each(function(){
			if ($(this)[0].offsetHeight < $(this)[0].scrollHeight){
				var id=$(this).attr('id');
				id =id.substring(5);
				$(this).after('<div style="text-align:center"><a href="" class="list-more" data-id="' + id + '"><i class="fa fa-angle-double-down"></i></a></div>');
			}
		});
	});
	var g_id="1717428084866022";
	var keywords =new Array();
		function get_download_user(){
		var url ="/Download/get_download_user/id/"+g_id+".html";
		$.get(url,function(ret){
			if(ret.length ==0) return;
			var html='';
			for(i in ret){
				html =html + '<a href=/User/profile/id/'+ret[i].user_new_id+'.html>'+ret[i].name+'</a> ';
			}
			$('#download-users').append(html);
		});
	}
	
	function get_relate_item(){
		var url ="/Download/get_relate_item/id/"+g_id+'.html';
		$.get(url,function(ret){
			if(ret.length ==0) return;
			var html='';
			var intro;
			for(i in ret){
				intro =ret[i].intro;
				for(j in keywords){
					var reg =new RegExp(keywords[j],'gmi');
					intro =intro.replace(reg,'<font color=brown>'+keywords[j]+'</font>');
				}
				html =html + '[<a href=/Download/item/id/'+ret[i].new_id+'.html>'+ret[i].name+'</a>]&nbsp; '+intro+'<BR>';
			}
			$('#relate-items').append(html);
		});
		
	}
	function get_score_name(score){
		switch(score){
		case '100': return '很好，推荐下载';
		case '85': return '还不错';
		case '75': return '一般，勉强可用';
		case '50': return '差';
		case '3': return '纯粹是垃圾';
		case '40': return '和说明完全不符';
		case '20': return '文件不全';
		case '10': return '不是源代码或资料';
		case '5': return '文件有密码，不知道密码';
		case '0': return '不能解压或下载失败';
		}
		return '';
	}
	function get_comment(){
		var url ="/Download/get_comments/id/"+g_id+'.html';
		$.get(url,function(ret){
			if(ret.length ==0) return;
			var total_count =ret.total_count;
			var data =ret.data;
			var html='';
			for(i in data){
				html =html + '<a href="/User/profile/id/'+data[i].user_new_id+'.html" class="uploader">'+data[i].user_name+'</a>: <span class="comment-score">'+get_score_name(data[i].score)+'</span>, '+data[i].content+'<BR>';
			}
			$('#file-comments').append(html);
		});
		
	}
	function get_favor(){
		var url ="/Download/get_item_favors/id/"+g_id+".html";
		$.get(url,function(ret){
			if(ret.length ==0) return;
			var html='';
			for(i in ret){
				html =html + '<a href=/User/profile/id/'+ret[i].user_new_id+'.html class=user>'+ret[i].name+'</a>&nbsp;';
			}
			$('#favor-users').html(html);
		});
	}
	// 得到下载这个的用户又下载了什么
	function get_more_download(){
		
	}
	// 得到下载这个的用户又搜索了什么
	function get_more_keyword(){
		
	}
	
	// 得到论坛相关问题
	function get_bbs(){
		
	}
	
	// 得到软件工场相关内容
	function get_works(){
		
	}
	
	// 得到相关聊天室
	function get_chat(){
		
	}
	
	// 得到相关软件商城信息
	function get_shop(){
		
	}
	
	// 得到job
	
	// 得到学习内容

	// 数据
	get_download_user();
	//get_relate_item();
	get_comment();
	get_favor();
	
	$('.vote-up').click(function(){
		var url="/Download/vote/t/up/id/"+g_id;
		$.get(url,function(ret){
			if(ret.status==0){
				alert(ret.info);
				if(ret.url.length >0)
					location.href=ret.url;
			}
			else{
				var s =$('#vote-up-count').html();
				if(s =='') s="0";
				var count =parseInt(s)+1;
				$('#vote-up-count').html(count);
			}
		})
		return false;
	});
	$('.vote-down').click(function(){
		var url="/Download/vote/t/down/id/"+g_id;
		$.get(url,function(ret){
			if(ret.status==0)
				alert(ret.info);
			else{
				var s =$('#vote-down-count').html();
				if(s =='') s="0";
				var count =parseInt(s)+1;
				$('#vote-down-count').html(count);
			}
		})
		return false;
	});
	$('.favor-item').click(function(){
		var url="/Favor/add/t/0/id/"+g_id;
		$.get(url,function(ret){
			if(ret.status==0){
				alert(ret.info);
			}
			else{
				var s =$('#favor-count').html();
				if(s =='') s="0";
				var count =parseInt(s)+1;
				$('#favor-count').html(count);
			}
		})
		return false;
	});
	$('.pop-a').click(function(){
		var url=$(this).attr('href');
		$.get(url,function(ret){
			alert(ret.info);
			//location.reload();
		})
		return false;
	});

document.getElementById('readme').innerHTML =marked.parse(document.getElementById('readme').innerHTML);
</script>



</html>