
<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>genesis 联合开发网 - pudn.com</title>

    <link href="/Public/m/css/bootstrap.min.css" rel="stylesheet">
    <link href="/Public/m/font-awesome/css/font-awesome.css" rel="stylesheet">

    <link href="/Public/m/css/animate.css" rel="stylesheet">
    <link href="/Public/m/css/style.css" rel="stylesheet">

	<link href="/Public/m/css/plugins/slick/slick.css" rel="stylesheet">
	<link href="/Public/m/css/plugins/slick/slick-theme.css" rel="stylesheet">

	

	<link href="/css/style.css" rel="stylesheet">

	<!-- Mainly scripts -->
	<script src="/Public/m/js/jquery-2.1.1.js"></script>
	<script src="/Public/m/js/bootstrap.min.js"></script>

	<script src="/Public/m/js/plugins/metisMenu/jquery.metisMenu.js"></script>
	<script src="/Public/m/js/plugins/slimscroll/jquery.slimscroll.min.js"></script>

	<!-- Custom and plugin javascript -->
	<script src="/Public/m/js/inspinia.js"></script>
	<script src="/Public/m/js/plugins/pace/pace.min.js"></script>
	
<META name="Keywords" content="genesis spring-boot mapper spring-cloud swagger-ui mybatis 程序员 编程 源码 源代码 下载">

	
<META name="Description" content="genesis 弹簧云示例">

</head>

<body>

<!-- /.main-container start -->

<div class="pace  pace-inactive">
  	<div class="pace-progress" data-progress-text="100%" data-progress="99" style="transform: translate3d(100%, 0px, 0px);">
  	<div class="pace-progress-inner"></div>
	</div>
	<div class="pace-activity"></div>
</div>

<div class="all-content">
	<div class="my-container top-navigation">
		<nav class="navbar navbar-static-top" role="navigation">
			<div class="navbar-header">
				<button aria-controls="navbar" aria-expanded="false" data-target="#navbar" data-toggle="collapse" class="navbar-toggle collapsed" type="button">
					<i class="fa fa-reorder"></i>
				</button>
				<a href="http://www.pudn.com" class="navbar-brand">联合开发网</a>
			</div>
			<div class="navbar-collapse collapse" id="navbar">
				<ul class="nav navbar-nav">
					<li>
						<a href="/" style="padding-right:8px;padding-left:8px;font-size:16px">首页</a>
					</li>
					<li>
						<a href="https://search.pudn.com" style="padding-right:8px;padding-left:8px;font-size:16px">搜索</a>
					</li>
				</ul>
               	<ul class="nav navbar-top-links navbar-right">
               							<li>
                       	<a href="/User/login.html">
                           	&nbsp; <i class="fa fa-sign-out"></i>登录
                       	</a>
                   	</li>
                   	<li>
                       	<a href="/User/reg.html"><i class="fa fa-sign-out"></i>注册
                       	</a>
                   	</li>
					               	</ul>
			</div>
		</nav>
	</div>
	<form action="https://search.pudn.com/Download" method="get">
	<div class="top-menu-line2">
		<div class="my-container">
			<a href=/Download/upload.html>上传</a>
			&nbsp; <a href=/User>管理</a>
			&nbsp; <a href=https://search.pudn.com/Download>搜索</a>
			&nbsp; <a href=/Guestbook>留言</a>
			<div class="input-group pull-right" style="max-width:200px;margin:3px 15px 0px 0px">
				<input type="text" name="keyword" maxlength=20 placeholder="请输入关键字" class="form-control input-sm">
				<span class="input-group-btn"> <button type="submit" class="btn btn-white input-sm" style="border:1px solid #AAA"><i class="fa fa-search"></i></button>
				</span>
			</div>
		</div>
	</div></form>



<div class="row wrapper white-bg">
	<div class="my-container">
			<div class="nav-dir" style="padding:10px 0px">
				<a href="/">Pudn.com</a>&nbsp;&gt;&nbsp;下载中心
				&nbsp;&gt;&nbsp;其他				&nbsp;&gt;&nbsp;<font color=red>genesis</font>
			</div>


		<div class="row">
			<div class="col-xs-12 col-md-8">
				<div class="item-name">genesis</div>
				<div class="item-keyword">
					<a href="#" class="keyword" keyword="spring-boot">spring-boot</a>&nbsp;<a href="#" class="keyword" keyword="mapper">mapper</a>&nbsp;<a href="#" class="keyword" keyword="spring-cloud">spring-cloud</a>&nbsp;<a href="#" class="keyword" keyword="swagger-ui">swagger-ui</a>&nbsp;<a href="#" class="keyword" keyword="mybatis">mybatis</a>&nbsp;				</div>
				<div class="item-action">
					<div class="btn-group">
						<a href=/Download/dl/id/1700281769843989 target=_blank class="btn btn-primary btn-sm">去下载(<span id="down-count">0</span>)</a>
						<a href="###" class="btn btn-white btn-sm vote-up"><i class="fa fa-thumbs-up"></i> 赞(<span id="vote-up-count">80</span>) </a>
						<a href="###" class="btn btn-white btn-sm vote-down"><i class="fa fa-thumbs-down"></i> 踩(<span id="vote-down-count">0</span>) </a>
						<a href="/Download/comment/id/1700281769843989" data-toggle="modal" data-target="#myModal" class="btn btn-white btn-sm"><i class="fa fa-comment"></i> 评论(<span id="comment-count">0</span>) </a>
						<a href="###" class="btn btn-white btn-sm favor-item"><i class="fa fa-heart"></i> 收藏(<span id="favor-count">0</span>) </a>
					</div>
				</div>
				<hr>

				<div class="item-info">
					<B>所属分类</B>：其他<BR>
					<B>开发工具</B>：Java<BR>
					<B>文件大小</B>：0KB<BR>
					<B>下载次数</B>：0<BR>
					<B>上传日期</B>：2017-11-03 08:39:43<BR>
					<B>上 传 者</B>：<a href=/User/profile/id/1682139907912860.html>sh-1993</a><BR>
				</div>
				<div class="item-intro">
					说明：&nbsp;&nbsp;弹簧云示例<BR>(Spring cloud Example)				</div>
				<hr>
				<div><B>文件列表</B>: </div>
				<div id="file-list">
				config-repo/ (0, 2017-11-03)<BR>config-repo/genesis-config-client-dev.<B>yml</B> (34, 2017-11-03)<BR>config-repo/genesis-config-client-test.<B>yml</B> (35, 2017-11-03)<BR>config-repo/genesis-oauth2-server.<B>properties</B> (3354, 2017-11-03)<BR>config-repo/genesis-server-zipkin-dev.<B>properties</B> (33, 2017-11-03)<BR>config-repo/genesis-server-zipkin-test.<B>properties</B> (34, 2017-11-03)<BR>genesis-common/ (0, 2017-11-03)<BR>genesis-common/pom.<B>xml</B> (1941, 2017-11-03)<BR>genesis-common/src/ (0, 2017-11-03)<BR>genesis-common/src/main/ (0, 2017-11-03)<BR>genesis-common/src/main/java/ (0, 2017-11-03)<BR>genesis-common/src/main/java/com/ (0, 2017-11-03)<BR>genesis-common/src/main/java/com/flame/ (0, 2017-11-03)<BR>genesis-common/src/main/java/com/flame/common/ (0, 2017-11-03)<BR>genesis-common/src/main/java/com/flame/common/utils/ (0, 2017-11-03)<BR>genesis-common/src/main/java/com/flame/common/utils/Arith.<B>java</B> (9843, 2017-11-03)<BR>genesis-common/src/main/java/com/flame/common/utils/collection/ (0, 2017-11-03)<BR>genesis-common/src/main/java/com/flame/common/utils/collection/MultiValueMap.<B>java</B> (1128, 2017-11-03)<BR>genesis-common/src/main/java/com/flame/common/utils/http/ (0, 2017-11-03)<BR>genesis-common/src/main/java/com/flame/common/utils/http/HttpClientUtils.<B>java</B> (10958, 2017-11-03)<BR>genesis-common/src/main/java/com/flame/common/utils/security/ (0, 2017-11-03)<BR>genesis-common/src/main/java/com/flame/common/utils/security/MD5Utils.<B>java</B> (4428, 2017-11-03)<BR>genesis-common/src/main/java/com/flame/common/utils/time/ (0, 2017-11-03)<BR>genesis-common/src/main/java/com/flame/common/utils/time/DateUtils.<B>java</B> (25068, 2017-11-03)<BR>genesis-core/ (0, 2017-11-03)<BR>genesis-core/pom.<B>xml</B> (2736, 2017-11-03)<BR>genesis-core/src/ (0, 2017-11-03)<BR>genesis-core/src/main/ (0, 2017-11-03)<BR>genesis-core/src/main/java/ (0, 2017-11-03)<BR>genesis-core/src/main/java/com/ (0, 2017-11-03)<BR>genesis-core/src/main/java/com/flame/ (0, 2017-11-03)<BR>genesis-core/src/main/java/com/flame/core/ (0, 2017-11-03)<BR>genesis-core/src/main/java/com/flame/core/constant/ (0, 2017-11-03)<BR>genesis-core/src/main/java/com/flame/core/constant/ErrorInfoEnum.<B>java</B> (600, 2017-11-03)<BR>genesis-core/src/main/java/com/flame/core/constant/GlobalErrorInfoEnum.<B>java</B> (814, 2017-11-03)<BR>genesis-core/src/main/java/com/flame/core/dao/ (0, 2017-11-03)<BR>genesis-core/src/main/java/com/flame/core/dao/mybatis/ (0, 2017-11-03)<BR>genesis-core/src/main/java/com/flame/core/dao/mybatis/BaseMapper.<B>java</B> (397, 2017-11-03)<BR>genesis-core/src/main/java/com/flame/core/dao/mybatis/interceptor/ (0, 2017-11-03)<BR>... ...<BR>				</div>
				<hr>
				<div id="readme">
				## Genesis. Is a Spring Cloud Project

------
## 技术架构
genesis 是一个基于Spring cloud(Camden.SR1) Spring Boot(1.4.1.RELEASE) Mybatis(3.3.0) 通用Mapper 通用分页Pagehelper完成的一个基础组件架构，
使用Spring Cloud Eureka、Feign、Zuul、Spring config、Zipkin、Sleuth、Hystrix Turbine、Hystrix Dashboard...
## MAVEN模块说明
#### 1. 基础组件说明
| 项目名称                                     | 端口   | 描述                     | URL             |
| ---------------------------------------- | ---- | ---------------------- | --------------- |
| genesis-common                | 无 | 公共模块（工具类,资源......）            | 无            |
| genesis-core               | 无 | 核心代码               | 无            |
| genesis-model               | 无 | 公共实体对象      
| spar_generator              | 无 | 生成mybatis mapper model实体      
| spar_mapper               | 无 | 抽离的mapper mapper.xml     
------
#### 2. Spring Cloud(genesis-microservices)组件说明
| 项目名称                                     | 端口   | 描述                     | URL             |
| ---------------------------------------- | ---- | ---------------------- | --------------- |
| genesis-microservices-discovery               | 8761 8762 8763 | 服务注册中心(用作和8762 8763实现高可用注册中心)            | 无            |
| genesis-microservices-config               | 8040 | 服务配置中心服务          | 无            |
| genesis-microservices-config-client               | 8041 | 服务配置客户端测试启动访问(ip:port/message打印)            | 无            |
| genesis-microservices-gateway               | 8050 | 服务网关    | 无            |
| genesis-microservices-hystrix-dashboard               | 8051 | 服务监控(Hystrix Dashboard)    | 无            |
| genesis-microservices-hystrix-turbine               | 8052 |  服务监控(Hystrix  Turbine)  | 无            |
| genesis-microservices-monitor               | 8060 | 服务监控(spring boot admin)    | 无            |
| genesis-microservices-security               | 无 | security    | 无            | 
| genesis-microservices-sleuth               | 8092 | 提供测试Zipkin 服务 提供本地、远程调用API    | 无            |
| genesis-microservices-zipkin               | 8091 |Zipkin Server 对Spring Cloud应用进行服务追踪分析(主要和Sleuth)    | 无            |
| genesis-microservices-bus-kafka               | 无 |bus-kafka    | 无            |
| genesis-microservices-bus-amqp                | 无 |bus-amqp    | 无            |
------
#### 3. Spring(genessis-spring)扩展组件说明
| 项目名称                                     | 端口   | 描述                     | URL             |
| ---------------------------------------- | ---- | ---------------------- | --------------- |
| genesis-spring-extends                | 无 | Spring 扩展(更新中...)            | 无            |
| genesis-spring-plugins              | 无 | Spring 插件(更新中...)               | 无            |
| genesis-spring-plugins-mybatis             | 无 | Spring boot mybatis stater自定义(在genesis-provider-goods使用测试)             | 无            |
------
#### 4. Examples(genesis-examples) 提供真是服务使用
| 项目名称                                     | 端口   | 描述                     | URL             |
| ---------------------------------------- | ---- | ---------------------- | --------------- |
| genesis-common-config                | 无 | 通用配置            | 无            |
| genesis-provider-by-feign                | 8080 | API接口(使用Feign 负载均衡)            | 无            |
| genesis-provider-by-ribbon                | 8084 | API接口(使用 Ribbon 负载均衡)            | 无            |
| genesis-provider-by-zuul                | 8085 | API接口网关(使用Zuul)            | 无            |
| genesis-provider-goods              | 8081 | Goods服务提供者(此服务使用了genesis-spring-plugins-mybatis stater)              | 无            |
| genesis-provider-goods2              | 8082 | Goods服务提供者(用于启动测试 API goods模块Feign Client负载均衡)              | 无            
| genesis-provider-order              | 8083 | Order服务提供者              | 无            |
| genesis-sleuth-zipkin-demo              | 8093 | sleuth-zipkin-demo 接口              | 无            |
------
#### 5. 分布式事务Example(更新中....)(genesis-transaction-examples) 提供LCN分布式事务功能实现        |
| 项目名称                                     | 端口   | 描述                     | URL             |
| ---------------------------------------- | ---- | ---------------------- | --------------- |
| tx-manager              | 8010 | 事务管理            | 无            |
| tx-user-ms              | 8011 | 用户服务          | 无            |
| tx-userMoney-ms             | 1012 | 用户金钱管理服务          | 无            |


## 架构图(目前待完善)

后续会更新架构图出去，暂时先这样看着... 焦灼中..........

![Markdown](http://p1.bqimg.com/1949/744b75531ed0a198.png)

## 服务中心HA说明
| 项目名称                                     | 端口   | 描述                     | URL             |
| ---------------------------------------- | ---- | ---------------------- | --------------- |
| genesis-microservices-discovery               | 8761  8762 8763| 服务注册中心)            | 无            |

> * 1,（C:\Windows\System32\drivers\etc\hosts文件）
```java
127.0.0.1 discovery1
127.0.0.1 discovery2
127.0.0.1 discovery3
```
	

> * 2,每个配置里面都有一个application.properties，本机为了方便在idea工具启动  所以使用了两个项目

> * 3,以后线上可以使用一个工程即可 如下：



#### application-chengdu-1.properties
```java
spring.application.name=eureka-server-clustered
server.port=8761
eureka.instance.hostname=discovery1
eureka.client.serviceUrl.defaultZone=http://${security.user.name}:${security.user.password}@discovery2:8762/eureka/,http://${security.user.name}:${security.user.password}@discovery3:8763/eureka/
```

#### application-chengdu-2.properties
```java
spring.application.name=eureka-server-clustered
server.port=8762
eureka.instance.hostname=discovery2
eureka.client.serviceUrl.defaultZone=http://${security.user.name}:${security.user.password}@discovery1:8761/eureka/,http://${security.user.name}:${security.user.password}@discovery3:8763/eureka/
```

#### application-chengdu-3.properties
```java
spring.application.name=eureka-server-clustered
server.port=8763
eureka.instance.hostname=discovery3
eureka.client.serviceUrl.defaultZone=http://${security.user.name}:${security.user.password}@discovery1:8761/eureka/,http://${security.user.name}:${security.user.password}@discovery2:8762/eureka/
```

### 命令启动格式1：
```java
java -jar discovery-1.0.0.jar  --spring.profiles.active=chengdu-1
java -jar discovery-1.0.0.jar --spring.profiles.active=chengdu-2
java -jar discovery-1.0.0.jar --spring.profiles.active=chengdu-3
```


命令修改为：
```java
java -jar discovery-1.0.0.jar
```
	
### 效果图:

### [访问discovery1](http://discovery1:8761)
![discovery1](http://i4.buimg.com/1949/c1c8bed93bd1e784s.jpg)
	

## 监控视图测试

### 使用说明：


#### Spring boot Admin 监控
> * 数据库脚本 genesis-common-config resources/db/下面spring-cloud-test.sql
> * 首先启动：genesis-microservices-monitor 端口 8060
> * 启动 genesis-provider-goods 端口 8081

访问 http://localhost:8060 admin UI
访问 http://localhost:8081/goods
#### 效果图

-----
#### Hystrix-dashboard 监控
> * 数据库脚本 genesis-common-config resources/db/下面spring-cloud-test.sql
> * 首先启动：genesis-microservices-discovery
> * 启动genesis-microservices-hystrix-dashboard 端口 8051
> * 启动genesis-provider-by-feign 端口8080

访问 http://localhost:8051 
在地址栏输入:http://localhost:8080/hystrix.stream

#### 效果图
![效果图](http://i4.buimg.com/1949/0b6e7467b99a1e00.jpg)

-----
#### Hystrix Turbine 监控
> * 数据库脚本 genesis-common-config resources/db/下面spring-cloud-test.sql
> * 首先启动：genesis-microservices-discovery
> * genesis-provider-goods,genesis-provider-order
> * genesis-provider-by-feign,genesis-provider-by-ribbon
> * genesis-microservices-hystrix-dashboard 端口 8051
> * 启动genesis-microservices-hystrix-turbine 端口 8052
> * 分别启动 genesis-provider-goods 端口8081 、genesis-provider-order 端口 8083

访问http://localhost:8051
输入框输入：http://localhost:8052/turbine.stream 
分别访问 feign ribbon 
#### 效果图1
![效果图1](http://i4.buimg.com/1949/38ae38087f6ff6cd.jpg)
确认：
#### 效果图2
![效果图2](http://i4.buimg.com/1949/d4bc21c6f96033b3.jpg)


## 服务跟踪监控Zipkin、Sleuth 测试

### 使用说明：

#### 项目启动
> * 启动 Zipkin Server 服务 genesis-microservices-zipkin 端口 8091
> * 启动 Zipkin Server 服务demo  genesis-microservices-sleuth 端口 8092
> * 启动测试 Zipkin、Sleuth 服务提供者  genesis-sleuth-zipkin-demo 端口 8093
> * 直接调用 8092 Controller接口即可

#### 跟踪列表效果图

![跟踪列表](http://i2.bvimg.com/607995/f0d7b6f6dfcaca6d.jpg)

#### 跟踪详细信息效果图

![跟踪详细信息](http://i2.bvimg.com/607995/e99769c237cb33b6.jpg)

## Zuul 和 Feign 测试

### 使用说明：

#### 1,项目启动：
> * 数据库脚本 genesis-common-config resources/db/下面spring-cloud-test.sql
> * 首先启动：genesis-microservices-discovery
> * 测试Fegin可以启动genesis-provider-by-feign。前提启动genesis-provider-good、genesis-provider-order
> * 测试Zuul可以启动genesis-provider-by-zuul 。前提启动genesis-provider-good、genesis-provider-order
> * genesis-provider-by-feign提供swgger UI 通过API文档Try 就可以了


## API 文档访问测试

### 使用说明：

#### 1,项目启动：
> * 启动API genesis-provider-by-feign访问http://localhost:8080/swagger-ui.html
![Markdown](http://i2.bvimg.com/607995/7d2dd1afb7ee0104.jpg)


## 分布式事务基于Spring Cloud + LCN

### LCN 
    首先感谢LCN提供
[LCN](https://github.com/1991wangliang/tx-lcn)

### 使用说明：
    
#### 1,项目启动：

> * 首先启动 tx-manager
[tx-manager](http://localhost:8100/index)

效果图
![manager](http://i1.bvimg.com/607995/10d7b69bf61f4e10.jpg)

> * 启动 tx-user-ms 和 tx-user-money-ms

#### 测试

> * 访问 http://localhost:8011/user/save

Controller  

```java
@RequestMapping(value = "/save",method = RequestMethod.POST)
    public int save() {
        return userService.save();
    }
```


Service

```java
    @TxTransaction
    @Transactional
    public int save() {

        User user = new User();
        user.setUserName("Test Tx");
        user.setPassword("11111");
        int rs1 = userMapper.insert(user);
        /**
         * 保存 余额 分布式服务
         */
        int rs2 = userMoneyClient.save();

        /**
         * 抛出异常
         */
        int v = 100 / 0;
        return rs1 + rs2;
    }
```


UserMoneyClient

```java
@FeignClient(name = "genesis-tx-user-money-ms", configuration = TransactionRestTemplateConfiguration.class)
public interface UserMoneyClient {

    @RequestMapping(value = "/user-money/save",method = RequestMethod.POST)
    int save();
}
```
    


				</div>
				<hr>
				<div><B>近期下载者</B>：</div>
				<div id="download-users"></div>
				<hr>
				<div><B>相关文件</B>：</div>
				<div id="relate-items"></div>
				<hr>
				<div><B>评论</B>：[<a href=/Download/comment/id/1700281769843989.html data-toggle=modal data-target="#myModal">我要评论</a>]&nbsp;[<a class='pop-a' href=/Download/report/id/1700281769843989.html>举报此文件</a>]</div>
				<div id="file-comments"></div>
				<hr>
				<div><B>收藏者</B>：</div>
				<div id="favor-users"></div>
				<p></p>
			</div>

			<div class="col-xs-12 col-md-4">

				<div class="ad-sidebar text-center">
					<div class="ad-300">
					</div>
				</div>
			</div>
		</div>

	</div>
</div>



	<div class="my-footer">
		<div class="container">
		<div class="pull-right">
		</div>

		<div>
			
			<a href="http://www.pudn.com" target=_blank>© 联合开发网 from 2004</a> | 
			<a href="/Index/contact.html">联系站长</a> | 
			<a href=" https://beian.miit.gov.cn" target=_blank>湘ICP备2023001425号</a> | 
			<a href="http://www.beian.gov.cn/portal/registerSystemInfo?recordcode=43010502000604" target=_blank>网安备43010502000604</a> | 
		</div>
		</div>
	</div>


</div><!-- /wrapper-->




<!-- page specific plugin scripts -->

<!-- inline scripts related to this page -->

<div id="myModal" class="modal fade" tabindex="-1" 
			role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
	<div class="modal-dialog">
		<div class="modal-content">
			
		</div>
	</div>
</div><!-- /.modal-table -->

</body>

<script type="text/javascript">
$(document).on('click', '.list-more', function(){
	var id=$(this).attr('data-id');
	$('#list-'+id).css('max-height',$('#list-'+id)[0].scrollHeight);
	$(this).removeClass('list-more');
	$(this).addClass('list-hide');
	$(this).html('<i class="fa fa-angle-double-up"></i>');
	
	//$(this).hide();

	return false;
});

$(document).on('click', '.list-hide', function(){
	var id=$(this).attr('data-id');
	$('#list-'+id).css('max-height','100px');
	$(this).removeClass('list-hide');
	$(this).addClass('list-more');
	$(this).html('<i class="fa fa-angle-double-down"></i>');
	
	return false;
});

$("#myModal").on("hidden.bs.modal", function() {
    $(this).removeData();
});

$(document).on("click",".keyword",function(){
	var keyword=$(this).attr("keyword");
	var type_id=$(this).attr("type_id");
	if(typeof(type_id) =="undefined" || type_id =="") type_id="0";
	location.href="http://search.pudn.com/Download/index?keyword="+keyword;
	
	return false;
});
</script>
<script type="text/javascript" src="/js/time.js"></script>


<script type="text/javascript" src="/js/marked.min.js"></script>
<script type="text/javascript">
	$(document).ready(function(){
		$('.hide-list').each(function(){
			if ($(this)[0].offsetHeight < $(this)[0].scrollHeight){
				var id=$(this).attr('id');
				id =id.substring(5);
				$(this).after('<div style="text-align:center"><a href="" class="list-more" data-id="' + id + '"><i class="fa fa-angle-double-down"></i></a></div>');
			}
		});
	});
	var g_id="1700281769843989";
	var keywords =new Array();
	keywords[0] ='spring-boot';keywords[1] ='mapper';keywords[2] ='spring-cloud';keywords[3] ='swagger-ui';keywords[4] ='mybatis';	function get_download_user(){
		var url ="/Download/get_download_user/id/"+g_id+".html";
		$.get(url,function(ret){
			if(ret.length ==0) return;
			var html='';
			for(i in ret){
				html =html + '<a href=/User/profile/id/'+ret[i].user_new_id+'.html>'+ret[i].name+'</a> ';
			}
			$('#download-users').append(html);
		});
	}
	
	function get_relate_item(){
		var url ="/Download/get_relate_item/id/"+g_id+'.html';
		$.get(url,function(ret){
			if(ret.length ==0) return;
			var html='';
			var intro;
			for(i in ret){
				intro =ret[i].intro;
				for(j in keywords){
					var reg =new RegExp(keywords[j],'gmi');
					intro =intro.replace(reg,'<font color=brown>'+keywords[j]+'</font>');
				}
				html =html + '[<a href=/Download/item/id/'+ret[i].new_id+'.html>'+ret[i].name+'</a>]&nbsp; '+intro+'<BR>';
			}
			$('#relate-items').append(html);
		});
		
	}
	function get_score_name(score){
		switch(score){
		case '100': return '很好，推荐下载';
		case '85': return '还不错';
		case '75': return '一般，勉强可用';
		case '50': return '差';
		case '3': return '纯粹是垃圾';
		case '40': return '和说明完全不符';
		case '20': return '文件不全';
		case '10': return '不是源代码或资料';
		case '5': return '文件有密码，不知道密码';
		case '0': return '不能解压或下载失败';
		}
		return '';
	}
	function get_comment(){
		var url ="/Download/get_comments/id/"+g_id+'.html';
		$.get(url,function(ret){
			if(ret.length ==0) return;
			var total_count =ret.total_count;
			var data =ret.data;
			var html='';
			for(i in data){
				html =html + '<a href="/User/profile/id/'+data[i].user_new_id+'.html" class="uploader">'+data[i].user_name+'</a>: <span class="comment-score">'+get_score_name(data[i].score)+'</span>, '+data[i].content+'<BR>';
			}
			$('#file-comments').append(html);
		});
		
	}
	function get_favor(){
		var url ="/Download/get_item_favors/id/"+g_id+".html";
		$.get(url,function(ret){
			if(ret.length ==0) return;
			var html='';
			for(i in ret){
				html =html + '<a href=/User/profile/id/'+ret[i].user_new_id+'.html class=user>'+ret[i].name+'</a>&nbsp;';
			}
			$('#favor-users').html(html);
		});
	}
	// 得到下载这个的用户又下载了什么
	function get_more_download(){
		
	}
	// 得到下载这个的用户又搜索了什么
	function get_more_keyword(){
		
	}
	
	// 得到论坛相关问题
	function get_bbs(){
		
	}
	
	// 得到软件工场相关内容
	function get_works(){
		
	}
	
	// 得到相关聊天室
	function get_chat(){
		
	}
	
	// 得到相关软件商城信息
	function get_shop(){
		
	}
	
	// 得到job
	
	// 得到学习内容

	// 数据
	get_download_user();
	//get_relate_item();
	get_comment();
	get_favor();
	
	$('.vote-up').click(function(){
		var url="/Download/vote/t/up/id/"+g_id;
		$.get(url,function(ret){
			if(ret.status==0){
				alert(ret.info);
				if(ret.url.length >0)
					location.href=ret.url;
			}
			else{
				var s =$('#vote-up-count').html();
				if(s =='') s="0";
				var count =parseInt(s)+1;
				$('#vote-up-count').html(count);
			}
		})
		return false;
	});
	$('.vote-down').click(function(){
		var url="/Download/vote/t/down/id/"+g_id;
		$.get(url,function(ret){
			if(ret.status==0)
				alert(ret.info);
			else{
				var s =$('#vote-down-count').html();
				if(s =='') s="0";
				var count =parseInt(s)+1;
				$('#vote-down-count').html(count);
			}
		})
		return false;
	});
	$('.favor-item').click(function(){
		var url="/Favor/add/t/0/id/"+g_id;
		$.get(url,function(ret){
			if(ret.status==0){
				alert(ret.info);
			}
			else{
				var s =$('#favor-count').html();
				if(s =='') s="0";
				var count =parseInt(s)+1;
				$('#favor-count').html(count);
			}
		})
		return false;
	});
	$('.pop-a').click(function(){
		var url=$(this).attr('href');
		$.get(url,function(ret){
			alert(ret.info);
			//location.reload();
		})
		return false;
	});

document.getElementById('readme').innerHTML =marked.parse(document.getElementById('readme').innerHTML);
</script>



</html>